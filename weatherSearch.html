<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏® (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8fafc; }
        .weather-card { max-width: 480px; width: 100%; }
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-3xl shadow-xl weather-card border border-gray-100">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">üå¶Ô∏è ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</h2>
        
        <div class="flex gap-2 mb-6">
            <input 
                type="text" 
                id="cityInput" 
                placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û, ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô)"
                class="flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-400 outline-none transition-all"
            >
            <button id="searchBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all">
                <span id="btnText">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span>
                <span id="btnLoader" class="loader hidden"></span>
            </button>
        </div>

        <div id="weatherResult" class="text-center p-6 bg-slate-50 rounded-2xl hidden border border-gray-100">
            <h6 id="cityName" class="text-blue-600 text-uppercase fw-bold mb-1">--</h6>
            <div class="display-3 fw-bold text-gray-900 mb-0">
                <span id="tempValue">--</span><span class="fs-1 text-gray-400">¬∞C</span>
            </div>
            <p class="small text-gray-500 mt-2 mb-0">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="timeValue">--</span></p>
            <p id="geoInfo" class="mt-3 text-gray-400 text-xs italic"></p>
        </div>

        <div id="statusMsg" class="text-center mt-4 text-sm font-medium"></div>
    </div>

    <script>
        const cityInput = document.getElementById('cityInput');
        const searchBtn = document.getElementById('searchBtn');
        const btnText = document.getElementById('btnText');
        const btnLoader = document.getElementById('btnLoader');
        const weatherResult = document.getElementById('weatherResult');
        const statusMsg = document.getElementById('statusMsg');

        async function fetchWeather() {
            const city = cityInput.value.trim();
            if (!city) return;

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
            btnText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...";
            btnLoader.classList.remove('hidden');
            statusMsg.innerText = "";
            weatherResult.classList.add('hidden');

            try {
                // 1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Nominatim API (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API Key)
                // ‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° &limit=1 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                const geoUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city)}&format=json&limit=1`;
                const geoRes = await fetch(geoUrl, {
                    headers: { 'Accept-Language': 'th' } // ‡∏Ç‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                });
                
                if (!geoRes.ok) throw new Error("‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á");
                
                const geoData = await geoRes.json();
                
                if (geoData.length === 0) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏");
                }

                const location = geoData[0];
                const lat = location.lat;
                const lon = location.lon;

                // 2. ‡∏î‡∏∂‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏≤‡∏Å Open-Meteo ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`;
                const weatherRes = await fetch(weatherUrl);
                
                if (!weatherRes.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ");
                
                const weatherData = await weatherRes.json();
                const current = weatherData.current_weather;

                // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                document.getElementById('cityName').innerText = location.display_name.split(',')[0];
                document.getElementById('tempValue').innerText = current.temperature;
                document.getElementById('timeValue').innerText = new Date(current.time + "Z").toLocaleTimeString('th-TH');
                document.getElementById('geoInfo').innerText = `‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${parseFloat(lat).toFixed(4)}, ${parseFloat(lon).toFixed(4)}`;

                weatherResult.classList.remove('hidden');
                statusMsg.className = "text-center mt-4 text-sm font-medium text-green-500";
                statusMsg.innerText = "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";

            } catch (err) {
                console.error(err);
                statusMsg.className = "text-center mt-4 text-sm font-medium text-red-500";
                statusMsg.innerText = "‚ùå " + err.message;
            } finally {
                btnText.innerText = "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤";
                btnLoader.classList.add('hidden');
            }
        }

        searchBtn.addEventListener('click', fetchWeather);
        cityInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') fetchWeather(); });
    </script>
</body>
</html>